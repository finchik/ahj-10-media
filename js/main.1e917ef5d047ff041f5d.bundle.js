(self.webpackChunkahj_10_media=self.webpackChunkahj_10_media||[]).push([[179],{8257:(t,e,r)=>{var n=r(7583),i=r(9212),o=r(5637),s=n.TypeError;t.exports=function(t){if(i(t))return t;throw s(o(t)+" is not a function")}},2569:(t,e,r)=>{var n=r(7583),i=r(794),o=n.String,s=n.TypeError;t.exports=function(t){if(i(t))return t;throw s(o(t)+" is not an object")}},5766:(t,e,r)=>{var n=r(2977),i=r(6782),o=r(1825),s=function(t){return function(e,r,s){var a,c=n(e),u=o(c),p=i(s,u);if(t&&r!=r){for(;u>p;)if((a=c[p++])!=a)return!0}else for(;u>p;p++)if((t||p in c)&&c[p]===r)return t||p||0;return!t&&-1}};t.exports={includes:s(!0),indexOf:s(!1)}},9624:(t,e,r)=>{var n=r(7386),i=n({}.toString),o=n("".slice);t.exports=function(t){return o(i(t),8,-1)}},3058:(t,e,r)=>{var n=r(7583),i=r(8191),o=r(9212),s=r(9624),a=r(3649)("toStringTag"),c=n.Object,u="Arguments"==s(function(){return arguments}());t.exports=i?s:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=c(t),a))?r:u?s(e):"Object"==(n=s(e))&&o(e.callee)?"Arguments":n}},3478:(t,e,r)=>{var n=r(2870),i=r(929),o=r(6683),s=r(4615);t.exports=function(t,e){for(var r=i(e),a=s.f,c=o.f,u=0;u<r.length;u++){var p=r[u];n(t,p)||a(t,p,c(e,p))}}},57:(t,e,r)=>{var n=r(8494),i=r(4615),o=r(4677);t.exports=n?function(t,e,r){return i.f(t,e,o(1,r))}:function(t,e,r){return t[e]=r,t}},4677:t=>{t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},8494:(t,e,r)=>{var n=r(6544);t.exports=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},6668:(t,e,r)=>{var n=r(7583),i=r(794),o=n.document,s=i(o)&&i(o.createElement);t.exports=function(t){return s?o.createElement(t):{}}},6918:(t,e,r)=>{var n=r(5897);t.exports=n("navigator","userAgent")||""},4061:(t,e,r)=>{var n,i,o=r(7583),s=r(6918),a=o.process,c=o.Deno,u=a&&a.versions||c&&c.version,p=u&&u.v8;p&&(i=(n=p.split("."))[0]>0&&n[0]<4?1:+(n[0]+n[1])),!i&&s&&(!(n=s.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=s.match(/Chrome\/(\d+)/))&&(i=+n[1]),t.exports=i},5690:t=>{t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},7263:(t,e,r)=>{var n=r(7583),i=r(6683).f,o=r(57),s=r(1270),a=r(460),c=r(3478),u=r(4451);t.exports=function(t,e){var r,p,l,h,d,m=t.target,f=t.global,v=t.stat;if(r=f?n:v?n[m]||a(m,{}):(n[m]||{}).prototype)for(p in e){if(h=e[p],l=t.noTargetGet?(d=i(r,p))&&d.value:r[p],!u(f?p:m+(v?".":"#")+p,t.forced)&&void 0!==l){if(typeof h==typeof l)continue;c(h,l)}(t.sham||l&&l.sham)&&o(h,"sham",!0),s(r,p,h,t)}}},6544:t=>{t.exports=function(t){try{return!!t()}catch(t){return!0}}},8262:t=>{var e=Function.prototype.call;t.exports=e.bind?e.bind(e):function(){return e.apply(e,arguments)}},4340:(t,e,r)=>{var n=r(8494),i=r(2870),o=Function.prototype,s=n&&Object.getOwnPropertyDescriptor,a=i(o,"name"),c=a&&"something"===function(){}.name,u=a&&(!n||n&&s(o,"name").configurable);t.exports={EXISTS:a,PROPER:c,CONFIGURABLE:u}},7386:t=>{var e=Function.prototype,r=e.bind,n=e.call,i=r&&r.bind(n);t.exports=r?function(t){return t&&i(n,t)}:function(t){return t&&function(){return n.apply(t,arguments)}}},5897:(t,e,r)=>{var n=r(7583),i=r(9212),o=function(t){return i(t)?t:void 0};t.exports=function(t,e){return arguments.length<2?o(n[t]):n[t]&&n[t][e]}},911:(t,e,r)=>{var n=r(8257);t.exports=function(t,e){var r=t[e];return null==r?void 0:n(r)}},7583:(t,e,r)=>{var n=function(t){return t&&t.Math==Math&&t};t.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof r.g&&r.g)||function(){return this}()||Function("return this")()},2870:(t,e,r)=>{var n=r(7386),i=r(1324),o=n({}.hasOwnProperty);t.exports=Object.hasOwn||function(t,e){return o(i(t),e)}},4639:t=>{t.exports={}},275:(t,e,r)=>{var n=r(8494),i=r(6544),o=r(6668);t.exports=!n&&!i((function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},5044:(t,e,r)=>{var n=r(7583),i=r(7386),o=r(6544),s=r(9624),a=n.Object,c=i("".split);t.exports=o((function(){return!a("z").propertyIsEnumerable(0)}))?function(t){return"String"==s(t)?c(t,""):a(t)}:a},9734:(t,e,r)=>{var n=r(7386),i=r(9212),o=r(1314),s=n(Function.toString);i(o.inspectSource)||(o.inspectSource=function(t){return s(t)}),t.exports=o.inspectSource},2743:(t,e,r)=>{var n,i,o,s=r(9491),a=r(7583),c=r(7386),u=r(794),p=r(57),l=r(2870),h=r(1314),d=r(9137),m=r(4639),f="Object already initialized",v=a.TypeError,b=a.WeakMap;if(s||h.state){var g=h.state||(h.state=new b),y=c(g.get),_=c(g.has),w=c(g.set);n=function(t,e){if(_(g,t))throw new v(f);return e.facade=t,w(g,t,e),e},i=function(t){return y(g,t)||{}},o=function(t){return _(g,t)}}else{var S=d("state");m[S]=!0,n=function(t,e){if(l(t,S))throw new v(f);return e.facade=t,p(t,S,e),e},i=function(t){return l(t,S)?t[S]:{}},o=function(t){return l(t,S)}}t.exports={set:n,get:i,has:o,enforce:function(t){return o(t)?i(t):n(t,{})},getterFor:function(t){return function(e){var r;if(!u(e)||(r=i(e)).type!==t)throw v("Incompatible receiver, "+t+" required");return r}}}},9212:t=>{t.exports=function(t){return"function"==typeof t}},4451:(t,e,r)=>{var n=r(6544),i=r(9212),o=/#|\.prototype\./,s=function(t,e){var r=c[a(t)];return r==p||r!=u&&(i(e)?n(e):!!e)},a=s.normalize=function(t){return String(t).replace(o,".").toLowerCase()},c=s.data={},u=s.NATIVE="N",p=s.POLYFILL="P";t.exports=s},794:(t,e,r)=>{var n=r(9212);t.exports=function(t){return"object"==typeof t?null!==t:n(t)}},6268:t=>{t.exports=!1},5871:(t,e,r)=>{var n=r(7583),i=r(5897),o=r(9212),s=r(2447),a=r(7786),c=n.Object;t.exports=a?function(t){return"symbol"==typeof t}:function(t){var e=i("Symbol");return o(e)&&s(e.prototype,c(t))}},1825:(t,e,r)=>{var n=r(97);t.exports=function(t){return n(t.length)}},8640:(t,e,r)=>{var n=r(4061),i=r(6544);t.exports=!!Object.getOwnPropertySymbols&&!i((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},9491:(t,e,r)=>{var n=r(7583),i=r(9212),o=r(9734),s=n.WeakMap;t.exports=i(s)&&/native code/.test(o(s))},4615:(t,e,r)=>{var n=r(7583),i=r(8494),o=r(275),s=r(2569),a=r(8734),c=n.TypeError,u=Object.defineProperty;e.f=i?u:function(t,e,r){if(s(t),e=a(e),s(r),o)try{return u(t,e,r)}catch(t){}if("get"in r||"set"in r)throw c("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},6683:(t,e,r)=>{var n=r(8494),i=r(8262),o=r(112),s=r(4677),a=r(2977),c=r(8734),u=r(2870),p=r(275),l=Object.getOwnPropertyDescriptor;e.f=n?l:function(t,e){if(t=a(t),e=c(e),p)try{return l(t,e)}catch(t){}if(u(t,e))return s(!i(o.f,t,e),t[e])}},9275:(t,e,r)=>{var n=r(8356),i=r(5690).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return n(t,i)}},4012:(t,e)=>{e.f=Object.getOwnPropertySymbols},2447:(t,e,r)=>{var n=r(7386);t.exports=n({}.isPrototypeOf)},8356:(t,e,r)=>{var n=r(7386),i=r(2870),o=r(2977),s=r(5766).indexOf,a=r(4639),c=n([].push);t.exports=function(t,e){var r,n=o(t),u=0,p=[];for(r in n)!i(a,r)&&i(n,r)&&c(p,r);for(;e.length>u;)i(n,r=e[u++])&&(~s(p,r)||c(p,r));return p}},112:(t,e)=>{"use strict";var r={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,i=n&&!r.call({1:2},1);e.f=i?function(t){var e=n(this,t);return!!e&&e.enumerable}:r},6252:(t,e,r)=>{var n=r(7583),i=r(8262),o=r(9212),s=r(794),a=n.TypeError;t.exports=function(t,e){var r,n;if("string"===e&&o(r=t.toString)&&!s(n=i(r,t)))return n;if(o(r=t.valueOf)&&!s(n=i(r,t)))return n;if("string"!==e&&o(r=t.toString)&&!s(n=i(r,t)))return n;throw a("Can't convert object to primitive value")}},929:(t,e,r)=>{var n=r(5897),i=r(7386),o=r(9275),s=r(4012),a=r(2569),c=i([].concat);t.exports=n("Reflect","ownKeys")||function(t){var e=o.f(a(t)),r=s.f;return r?c(e,r(t)):e}},1270:(t,e,r)=>{var n=r(7583),i=r(9212),o=r(2870),s=r(57),a=r(460),c=r(9734),u=r(2743),p=r(4340).CONFIGURABLE,l=u.get,h=u.enforce,d=String(String).split("String");(t.exports=function(t,e,r,c){var u,l=!!c&&!!c.unsafe,m=!!c&&!!c.enumerable,f=!!c&&!!c.noTargetGet,v=c&&void 0!==c.name?c.name:e;i(r)&&("Symbol("===String(v).slice(0,7)&&(v="["+String(v).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!o(r,"name")||p&&r.name!==v)&&s(r,"name",v),(u=h(r)).source||(u.source=d.join("string"==typeof v?v:""))),t!==n?(l?!f&&t[e]&&(m=!0):delete t[e],m?t[e]=r:s(t,e,r)):m?t[e]=r:a(e,r)})(Function.prototype,"toString",(function(){return i(this)&&l(this).source||c(this)}))},3955:(t,e,r)=>{var n=r(7583).TypeError;t.exports=function(t){if(null==t)throw n("Can't call method on "+t);return t}},460:(t,e,r)=>{var n=r(7583),i=Object.defineProperty;t.exports=function(t,e){try{i(n,t,{value:e,configurable:!0,writable:!0})}catch(r){n[t]=e}return e}},9137:(t,e,r)=>{var n=r(7836),i=r(8284),o=n("keys");t.exports=function(t){return o[t]||(o[t]=i(t))}},1314:(t,e,r)=>{var n=r(7583),i=r(460),o="__core-js_shared__",s=n[o]||i(o,{});t.exports=s},7836:(t,e,r)=>{var n=r(6268),i=r(1314);(t.exports=function(t,e){return i[t]||(i[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.19.0",mode:n?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},6782:(t,e,r)=>{var n=r(7486),i=Math.max,o=Math.min;t.exports=function(t,e){var r=n(t);return r<0?i(r+e,0):o(r,e)}},2977:(t,e,r)=>{var n=r(5044),i=r(3955);t.exports=function(t){return n(i(t))}},7486:t=>{var e=Math.ceil,r=Math.floor;t.exports=function(t){var n=+t;return n!=n||0===n?0:(n>0?r:e)(n)}},97:(t,e,r)=>{var n=r(7486),i=Math.min;t.exports=function(t){return t>0?i(n(t),9007199254740991):0}},1324:(t,e,r)=>{var n=r(7583),i=r(3955),o=n.Object;t.exports=function(t){return o(i(t))}},2670:(t,e,r)=>{var n=r(7583),i=r(8262),o=r(794),s=r(5871),a=r(911),c=r(6252),u=r(3649),p=n.TypeError,l=u("toPrimitive");t.exports=function(t,e){if(!o(t)||s(t))return t;var r,n=a(t,l);if(n){if(void 0===e&&(e="default"),r=i(n,t,e),!o(r)||s(r))return r;throw p("Can't convert object to primitive value")}return void 0===e&&(e="number"),c(t,e)}},8734:(t,e,r)=>{var n=r(2670),i=r(5871);t.exports=function(t){var e=n(t,"string");return i(e)?e:e+""}},8191:(t,e,r)=>{var n={};n[r(3649)("toStringTag")]="z",t.exports="[object z]"===String(n)},8320:(t,e,r)=>{var n=r(7583),i=r(3058),o=n.String;t.exports=function(t){if("Symbol"===i(t))throw TypeError("Cannot convert a Symbol value to a string");return o(t)}},5637:(t,e,r)=>{var n=r(7583).String;t.exports=function(t){try{return n(t)}catch(t){return"Object"}}},8284:(t,e,r)=>{var n=r(7386),i=0,o=Math.random(),s=n(1..toString);t.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+s(++i+o,36)}},7786:(t,e,r)=>{var n=r(8640);t.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},3649:(t,e,r)=>{var n=r(7583),i=r(7836),o=r(2870),s=r(8284),a=r(8640),c=r(7786),u=i("wks"),p=n.Symbol,l=p&&p.for,h=c?p:p&&p.withoutSetter||s;t.exports=function(t){if(!o(u,t)||!a&&"string"!=typeof u[t]){var e="Symbol."+t;a&&o(p,t)?u[t]=p[t]:u[t]=c&&l?l(e):h(e)}return u[t]}},8407:(t,e,r)=>{"use strict";var n=r(7263),i=r(8494),o=r(7583),s=r(7386),a=r(2870),c=r(9212),u=r(2447),p=r(8320),l=r(4615).f,h=r(3478),d=o.Symbol,m=d&&d.prototype;if(i&&c(d)&&(!("description"in m)||void 0!==d().description)){var f={},v=function(){var t=arguments.length<1||void 0===arguments[0]?void 0:p(arguments[0]),e=u(m,this)?new d(t):void 0===t?d():d(t);return""===t&&(f[e]=!0),e};h(v,d),v.prototype=m,m.constructor=v;var b="Symbol(test)"==String(d("test")),g=s(m.toString),y=s(m.valueOf),_=/^Symbol\((.*)\)[^)]+$/,w=s("".replace),S=s("".slice);l(m,"description",{configurable:!0,get:function(){var t=y(this),e=g(t);if(a(f,t))return"";var r=b?S(e,7,-1):w(e,_,"$1");return""===r?void 0:r}}),n({global:!0,forced:!0},{Symbol:v})}},3012:(t,e,r)=>{"use strict";const n={memory:[],handler:null,listen(t){this.handler=t},add(t,e){if(this.memory.unshift({content:t,date:this.getDate(),coords:e}),!this.handler)throw new Error("handler is not bind to dataBase");this.handler()},getDate(){const t=new Intl.DateTimeFormat("ru",{timeZone:"Europe/Moscow",hour:"numeric",minute:"numeric",day:"numeric",month:"numeric",year:"numeric"}).format(new Date);return this.cleanDate(t)},cleanDate(t){const e=t.split(" ");return this.date=[e[0].slice(0,-1),e[1]].join(" "),this.date}};class i{constructor(){this.options={enableHighAccuracy:!1,timeout:5e3,maximumAge:0},this.coords=null,this.errorInfo=null,this.succesHandler=this.succesHandler.bind(this),this.errorHandler=this.errorHandler.bind(this)}getLocation(){return new Promise((t=>{navigator.geolocation?navigator.geolocation.getCurrentPosition((e=>t(this.succesHandler(e))),(e=>t(this.errorHandler(e)))):(this.errorInfo={success:!1,title:"Ваш браузер не поддерживает геолокацию",description:"К сожалению, нам не удалось определить ваше местоположение, смените браузер, либо введите координаты вручную."},t(this.errorInfo))}))}succesHandler(t){this.errorInfo=null;const{latitude:e,longitude:r}=t.coords;return this.coords={success:!0,latitude:+e.toFixed(5),longitude:+r.toFixed(5)},this.coords}errorHandler(t){switch(this.coords=null,t.code){case t.PERMISSION_DENIED:this.errorInfo={success:!1,title:"Настройки текущего браузера запрещают определение вашего местоположения",description:'К сожалению, нам не удалось определить ваше местоположение, потому что у страницы не было на это разрешения, нажмите кнопку "отмена", затем измените настройки конфидициальности в текущем браузере и повторите попытку, либо введите координаты вручную'};break;case t.POSITION_UNAVAILABLE:this.errorInfo={success:!1,title:"Информация о вашем текущем местоположении недоступна",description:'К сожалению, нам не удалось определить ваше местоположение, потому что один или несколько внутренних источников местоположения вернули внутреннюю ошибку, нажмите кнопку "отмена" и повторите попытку, либо введите координаты вручную'};break;case t.TIMEOUT:this.errorInfo={success:!1,title:"Истекло время ожидания",description:'К сожалению, нам не удалось определить ваше местоположение, поскольку информация о геолокации не была получена в отведенное время, нажмите кнопку "отмена" и повторите попытку, либо введите координаты вручную'};break;default:this.errorInfo={success:!1,title:"Произошла неизвестная ошибка",description:'К сожалению, нам не удалось определить ваше местоположение, нажмите кнопку "отмена" и повторите попытку, либо введите координаты вручную'}}return this.errorInfo}}class o{constructor(t){if(!(t instanceof HTMLElement))throw new Error("element is not HTMLElement");this.timer=t,this.min=0,this.sec=0,this.stopTime=!0,this.timeCycle=this.timeCycle.bind(this)}startTimer(){this.stopTime&&(this.stopTime=!this.stopTime,this.timeCycle())}stopTimer(){this.stopTime||(this.stopTime=!this.stopTime)}timeCycle(){this.stopTime||(this.sec=+this.sec+1,60===this.sec&&(this.min=+this.min+1,this.sec=0),(this.sec<10||0===this.sec)&&(this.sec="0"+ +this.sec),(this.min<10||0===this.min)&&(this.min="0"+ +this.min),this.timer.textContent=`${this.min}:${this.sec}`,setTimeout(this.timeCycle,1e3))}resetTimer(){this.timer.innerHTML="00:00",this.stopTime=!0,this.min=0,this.sec=0}}class s{constructor(t){this.popup=t,this.geoLocation=new i,this.btnMicro=document.querySelector(".form__micro"),this.btnVideo=document.querySelector(".form__camera"),this.mediaControl=document.querySelector(".form__media"),this.recordControl=document.querySelector(".form__record"),this.btnOk=document.querySelector(".form__record-btnOK"),this.btnCancel=document.querySelector(".form__record-btnCancel"),this.timer=document.querySelector(".form__timer"),this.video=document.querySelector(".form__preview-video"),this.recorder=null,this.stream=null,this.cancel=!1,this.timer=new o(document.querySelector(".form__timer")),this.contentType=null,this.onBtnOkClick=this.onBtnOkClick.bind(this),this.onBtnMediaClick=this.onBtnMediaClick.bind(this),this.onBtnCancelClick=this.onBtnCancelClick.bind(this),this.stopRecord=this.stopRecord.bind(this),this.dataavailable=this.dataavailable.bind(this),this.startRecord=this.startRecord.bind(this),this.btnMicro.addEventListener("click",this.onBtnMediaClick),this.btnVideo.addEventListener("click",this.onBtnMediaClick),this.btnOk.addEventListener("click",this.onBtnOkClick),this.btnCancel.addEventListener("click",this.onBtnCancelClick)}onBtnCancelClick(){this.cancel=!this.cancel,this.recorder.stop(),this.stream.getTracks().forEach((t=>t.stop())),this.timer.resetTimer(),this.recordControl.classList.add("d_none"),this.mediaControl.classList.remove("d_none"),"video"===this.contentType&&this.video.classList.add("d_none"),console.log("cancel")}onBtnOkClick(){this.recorder.stop(),this.stream.getTracks().forEach((t=>t.stop())),"video"===this.contentType&&this.video.classList.add("d_none")}async onBtnMediaClick(t){if(navigator.mediaDevices)try{if(this.cancel&&(this.cancel=!this.cancel),"form__micro"===t.target.className&&(this.contentType="audio",this.stream=await navigator.mediaDevices.getUserMedia(s.options.streamAudio)),"form__camera"===t.target.className&&(this.contentType="video",this.stream=await navigator.mediaDevices.getUserMedia(s.options.streamVideo),this.video.classList.remove("d_none"),this.video.srcObject=this.stream,this.video.play()),!window.MediaRecorder)return void this.showError(s.options.mediarecorder);this.recorder=new MediaRecorder(this.stream),this.chunks=[],this.recorder.addEventListener("start",this.startRecord),this.recorder.addEventListener("dataavailable",this.dataavailable),this.recorder.addEventListener("stop",this.stopRecord),this.recorder.start(),this.timer.startTimer()}catch(t){this.showError(s.options.access,t)}else this.showError(s.options.mediadevices)}showError(t,e=""){this.popup.changePopup(),this.popup.show(t),e&&console.error(e)}startRecord(){this.recordControl.classList.remove("d_none"),this.mediaControl.classList.add("d_none"),console.log("recording started")}dataavailable(t){this.cancel||(this.chunks.push(t.data),console.log("data available"))}stopRecord(){if(!this.cancel){const t=new Blob(this.chunks),e=URL.createObjectURL(t);let r;"audio"===this.contentType&&(r=`<audio src="${e}" controls></audio>`),"video"===this.contentType&&(r=`<video src="${e}" controls></video>`);this.geoLocation.getLocation().then((t=>{t.success?n.add(r,t):this.popup.show(t)})),this.timer.resetTimer(),this.recordControl.classList.add("d_none"),this.mediaControl.classList.remove("d_none"),console.log("recorder stopped")}}static get options(){return{access:{title:"Настройки вашего браузера запрещают доступ к микрофону или видеокамере",description:"К сожалению нам не удалось выполнить запись, потому что у страницы не было на это разрешения, измените настройки конфидициальности текущего браузера и повторите попытку"},mediarecorder:{title:"Ваш браузер не поддерживает API MediaRecorder",description:"К сожалению нам не удалось выполнить запись, потому что ваш браузер не поддерживает функцию записи аудио-видео, смените браузер и повторите попытку"},mediadevices:{title:"Ваш браузер не поддерживает API MediaDevices",description:"К сожалению нам не удалось выполнить запись, потому что ваш браузер не поддерживает функцию записи аудио-видео, смените браузер и повторите попытку"},streamAudio:{audio:!0,video:!1},streamVideo:{audio:!0,video:!0}}}}r(8407);class a{constructor(t=document.body){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=t,this.mainInput=this.container.querySelector(".form__input"),this.sample=null,this.cancelBtn=null,this.okBtn=null,this.popupInput=null,this.popupTitle=null,this.popupDescription=null,this.onOkClick=this.onOkClick.bind(this),this.resetChange=this.resetChange.bind(this)}init(){this.creat(),this.cancelBtn=document.querySelector('[data-name="cancel"]'),this.okBtn=document.querySelector('[data-name="save"]'),this.popupForm=document.querySelector(".popup__form"),this.popupInput=document.querySelector(".popup__input"),this.popupTitle=document.querySelector(".popup__title"),this.popupDescription=document.querySelector(".popup__description"),this.popupLabel=document.querySelector(".popup__label"),this.popupForm.addEventListener("submit",(t=>t.preventDefault())),this.cancelBtn.addEventListener("click",(()=>this.hide())),this.okBtn.addEventListener("click",this.onOkClick)}onOkClick(){if(this.popupInput.value)if(a.checkPopupInput(this.popupInput.value)){this.hideRedPlaceholder();const t=this.mainInput.value,e=a.formatingPopupInput(this.popupInput.value);n.add(t,e),this.mainInput.value="",this.popupInput.value="",this.hide()}else this.popupInput.value="",this.showRedPlaceholder("Неверный формат");else this.showRedPlaceholder("Заполните пожалуйста это поле")}showRedPlaceholder(t){this.popupInput.classList.add("red"),this.popupInput.placeholder=t}hideRedPlaceholder(){this.popupInput.className="popup__input",this.popupInput.placeholder="Введите координаты"}static formatingPopupInput(t){const e=t.replace(/^\[/,"").replace(/\]$/,"").split(",");return{latitude:+e[0],longitude:+e[1].replace(/^ /,"")}}static checkPopupInput(t){return/^\[?-?\d{1,2}(\.\d{1,5})?,\s?-?\d{1,2}(\.\d{1,5})?\]?$/.test(t)}static get markUP(){return'<div class="popup__body">\n     <div class="popup__content">\n      <h3 class="popup__title add"></h3>\n      <div class="popup__description"></div>\n      <form name="adding" class="popup__form" novalidate="">\n        <label class="popup__label">\n          <div class="popup__name">Широта и долгота через запятую:</div>\n          <input name="title" id="title" type="text" class="popup__input" required="" placeholder="Введите координаты">\n        </label>\n        <div class="popup__buttons">\n          <button name="save" data-name="save" class="button">Ok</button>\n          <button name="cancel" data-name="cancel" class="button">Отмена</button>\n        </div>\n      </form>\n    </div>\n  </div>'}creat(){this.sample=document.createElement("div"),this.sample.className="popup",this.sample.innerHTML=a.markUP,this.container.appendChild(this.sample)}show(t){t&&(this.popupTitle.textContent=t.title,this.popupDescription.textContent=t.description,this.sample.classList.add("open"))}changePopup(){this.okBtn.classList.add("d_none"),this.cancelBtn.classList.add("green"),this.cancelBtn.textContent="OK",this.popupLabel.classList.add("d_none")}resetChange(){this.okBtn.className="button",this.cancelBtn.className="button",this.cancelBtn.textContent="Отмена",this.popupLabel.className="popup__label"}hide(){this.sample.classList.remove("open"),setTimeout((()=>{this.popupInput.value="",this.popupTitle.textContent="",this.popupDescription.textContent="",this.resetChange()}),500)}}class c{constructor(t){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=t}static markUp(t,e,r){return`<div class="timeline__item">\n    <div class="timeline-item__data">${t}</div>\n    <div class="timeline-item__content">\n      ${e}\n    </div>\n    <div class="timeline-item__geo">\n      <span class="geo__data">[${r.latitude}, ${r.longitude}]</span>\n      <span class="geo__icon">\n        <svg class="geo-icon__svg" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="eye" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"></path></svg>\n      </span>\n    </div>\n  </div>`}draw(t){this.container.innerHTML="",t.forEach((t=>{this.container.insertAdjacentHTML("beforeend",c.markUp(t.date,t.content,t.coords))}))}}class u{constructor(t){this.form=document.querySelector(".form"),this.popup=t,this.input=this.form.querySelector(".form__input"),this.geoLocation=new i,this.onSubmit=this.onSubmit.bind(this),this.form.addEventListener("submit",this.onSubmit)}onSubmit(t){if(t.preventDefault(),this.input.value){this.hideRedPlaceholder();const t=this.input.value;this.geoLocation.getLocation().then((e=>{e.success?(n.add(t,e),this.input.value=""):this.popup.show(e)}))}else this.showRedPlaceholder("Введите пожалуйста сообщение")}showRedPlaceholder(t){this.input.classList.add("red"),this.input.placeholder=t}hideRedPlaceholder(){this.input.className="form__input",this.input.placeholder="Введите сообщение"}}new class{constructor(t){if(!(t instanceof HTMLElement))throw new Error("rootElement is not HTMLElement");this.rootElement=t,this.geoHandler=new i,this.popup=new a,this.textHandler=new u(this.popup),this.postRenderer=new c(this.rootElement.querySelector(".timeline")),this.mediaHandler=new s(this.popup)}init(){this.popup.init(),n.listen(this.postRenderer.draw.bind(this.postRenderer,n.memory))}}(document.getElementById("root")).init()}},t=>{var e;e=3012,t(t.s=e)}]);